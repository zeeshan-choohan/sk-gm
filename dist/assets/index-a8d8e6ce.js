(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))u(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const B of t.addedNodes)B.tagName==="LINK"&&B.rel==="modulepreload"&&u(B)}).observe(document,{childList:!0,subtree:!0});function v(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerPolicy&&(t.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?t.credentials="include":a.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function u(a){if(a.ep)return;a.ep=!0;const t=v(a);fetch(a.href,t)}})();(function(o){const m=[{name:"icons/00_cherry",radius:20},{name:"icons/01_strawberry",radius:26},{name:"icons/02_grape",radius:22},{name:"icons/03_orange",radius:32},{name:"icons/04_lemon",radius:34},{name:"icons/05_pear",radius:38},{name:"icons/06_apple",radius:28},{name:"icons/07_peach",radius:40},{name:"icons/08_pineapple",radius:46},{name:"icons/09_melon",radius:50},{name:"icons/10_watermelon",radius:53}],v={0:2,2:1,1:6,6:3,3:4,4:5,5:7,7:8,8:9,9:10};(function(){const u=o.Engine.create(),a=document.getElementById("game-container"),t=window.innerWidth<=480,B=o.Render.create({element:a,engine:u,options:{wireframes:!1,background:"#f9e2bb",width:t?340:400,height:t?480:540}}),g=u.world,O=o.Bodies.rectangle(0,t?230:255,15,t?480:520,{isStatic:!0,render:{fillStyle:"#f9e2bb"}}),$=o.Bodies.rectangle(t?335:400,t?230:255,10,t?480:520,{isStatic:!0,render:{fillStyle:"#f9e2bb"}}),L=o.Bodies.rectangle(t?170:200,t?470:520,t?350:400,15,{isStatic:!0,render:{fillStyle:"#68A542"}}),T=o.Bodies.rectangle(t?170:200,0,t?350:400,10,{isStatic:!0,render:{fillStyle:"#f9e2bb"}}),_=o.Bodies.rectangle(t?170:200,t?480:530,t?350:400,20,{isStatic:!0,render:{fillStyle:"#B7BFFC"}}),P=o.Bodies.rectangle(t?170:200,80,t?360:400,10,{isStatic:!0,isSensor:!0,render:{visible:!1},label:"gameEnd"});o.World.add(g,[O,$,L,T,_,P]);const h=document.createElement("div");h.className="gameEndLine",h.style.display="none",a.appendChild(h),o.Render.run(B);const C=o.Runner.create(),G=Date.now();requestAnimationFrame(function n(){o.Runner.tick(C,u,Date.now()-G),requestAnimationFrame(n)});const e={topLineVisible:!1,topLineTriggered:!1,isGameOver:!1,score:0,currentFruit:null,disableAction:!1,currentBody:null,pairsColliding:{},bestScore:(()=>{const n=localStorage.getItem("bestScore");return n?parseInt(n):0})()},b={drop:new Audio("drop.mp3"),collide:new Audio("collision.mp3"),largeCandy:new Audio("largeCandy.mp3"),burstsound:new Audio("burst.mp3")},W=document.getElementById("scoreboard"),k=document.getElementById("bestvalue");function E(){W.textContent=`${e.score}`,k.textContent=`${e.bestScore}`}E();let x=0,S=Math.floor(5*Math.random());function w(){if(e.isGameOver)return;const n=m[x],r=n.radius,i=document.getElementById("nextCandy");i.innerHTML='<div class="next">ネクスト</div>';const s=document.createElement("img");s.src=`${m[S].name}.png`,i.appendChild(s),setTimeout(()=>{const c=o.Bodies.circle(180,50,r,{collisionFilter:{category:1,mask:1},index:x,isSleeping:!0,label:"Circle Body",render:{sprite:{texture:`${n.name}.png`}},restitution:.3,friction:.05,density:.5});let y;e.currentBody=c,e.currentFruit=n,o.World.add(g,c),E(),x=S;do y=Math.floor(6*Math.random());while(y===x);S=y},100)}let A=[];function I(n,r){for(let i=0;i<20;i++){const s=A.pop();if(!s)return;const c=10*(Math.random()-.5),y=15*(Math.random()-.5);s.style.left=`${n.x+c}px`,s.style.top=`${n.y+y}px`,s.style.setProperty("--x-translate",`${c}px`),s.style.setProperty("--y-translate",`${y}px`),s.style.animationDelay=.5*Math.random()+"s",s.style.background=`radial-gradient(circle, hsl(${360*Math.random()}, 100%, 70%), hsl(${360*Math.random()}, 100%, 50%))`,s.style.display="block",setTimeout(()=>{s.style.display="none",A.push(s)},1e3)}}function F(n){if(e.disableAction||e.isGameOver||!e.currentBody)return;const r=document.getElementById("game-container").getBoundingClientRect();let i=n.type==="mousedown"?n.clientX-r.left:n.touches[0].clientX-r.left;i=Math.max(e.currentFruit.radius,Math.min(i,r.width-e.currentFruit.radius)),e.currentBody&&(o.Body.setPosition(e.currentBody,{x:i,y:e.currentBody.position.y}),e.disableAction=!0,setTimeout(()=>{b.drop.play(),e.currentBody.isSleeping=!1,o.Body.setVelocity(e.currentBody,{x:0,y:3}),setTimeout(()=>{e.disableAction=!1,w()},1e3)},100))}(function(){for(let n=0;n<100;n++){const r=document.createElement("div");r.className="burst-animation",r.style.display="none";const i=20*Math.random()+10;r.style.width=`${i}px`,r.style.height=`${i}px`,document.getElementById("game-container").appendChild(r),A.push(r)}})(),document.getElementById("game-container").addEventListener("mousedown",F),document.getElementById("game-container").addEventListener("touchstart",F),window.onkeydown=n=>{if(!e.disableAction&&!e.isGameOver)switch(n.code){case"KeyA":e.currentBody.position.x-e.currentFruit.radius>10&&o.Body.setPosition(e.currentBody,{x:e.currentBody.position.x-10,y:e.currentBody.position.y});break;case"KeyD":const r=document.getElementById("game-container").offsetWidth;e.currentBody.position.x+e.currentFruit.radius<r-15&&o.Body.setPosition(e.currentBody,{x:e.currentBody.position.x+10,y:e.currentBody.position.y});break;case"KeyS":e.currentBody&&(e.currentBody.isSleeping=!1,b.drop.play(),e.disableAction=!0,setTimeout(()=>{w(),e.disableAction=!1},1e3))}},u.constraintIterations=10,u.positionIterations=10,o.Events.on(u,"collisionActive",n=>{n.pairs.forEach(r=>{const{bodyA:i,bodyB:s}=r;if(e.isGameOver)return;if(!e.disableAction&&(r.bodyA.label==="gameEnd"||r.bodyB.label==="gameEnd"))return h.style.display="block",void function(){e.isGameOver=!0,e.disableAction=!0;const p=g.bodies.filter(f=>f.label==="Circle Body");let d=0;e.score>e.bestScore&&(e.bestScore=e.score,localStorage.setItem("bestScore",e.bestScore));function l(){if(d>=p.length)return;const f=p[d];I(f.position),b.largeCandy.play(),o.World.remove(g,f),d++,setTimeout(l,100)}l(),setTimeout(()=>{document.getElementById("final-score").textContent=`最終スコア: ${e.score}`;const f=new bootstrap.Modal(document.getElementById("gameOverModal"),{keyboard:!1});o.Runner.stop(C),f.show()},6e3)}();const c=i.index,y=s.index;if(o.Body.applyForce(i,i.position,{x:.005*(s.position.x-i.position.x),y:.005*(s.position.y-i.position.y)}),c!==void 0&&y!==void 0&&c===y&&!e.isGameOver&&!e.pairsColliding[c]){e.pairsColliding[c]=!0,function(d,l){if(Math.sqrt((l.position.x-d.position.x)**2+(l.position.y-d.position.y)**2)<100){const M={x:(l.position.x-d.position.x)*2e-5,y:(l.position.y-d.position.y)*2e-5};o.Body.applyForce(d,d.position,M),o.Body.applyForce(l,l.position,{x:-M.x,y:-M.y})}}(i,s),b.collide.play(),I(r.bodyA.position),b.burstsound.play(),setTimeout(()=>{o.World.remove(g,[i,s])},100),e.isGameOver||(e.score+=Math.floor(8*Math.random())+1,E());const p=v[c];if(p!==void 0&&p<m.length){const d=m[p],l=o.Bodies.circle(i.position.x,i.position.y,d.radius,{index:p,render:{sprite:{texture:`${d.name}.png`}},restitution:.3,friction:.01,density:.5});o.World.add(g,l),b.largeCandy.play()}setTimeout(()=>{e.pairsColliding[c]=!1},100)}})}),document.getElementById("replay-button").addEventListener("click",function(){location.reload()}),w()})()})(Matter);
